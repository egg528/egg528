# 계층형 아키텍처가 야기할 수 있는 문제점들

- 책에서 말하는 이상적인 아키텍처는 `선택의 폭을 넓히고, 변화하는 요구사항과 외부 요인에 빠르게 적응할 수 있는` 아키텍처라 정의한다.
  - 변화하는 비즈니스 로직을 빠르게 반영할 수 있고
  - 빠르게 단일 계층의 기술을 변경할 수 있는
- 3계층 구조 또한 위와 같은 조건을 충족시킬 수 있다.
  - 하지만 아래와 같은 문제점이 존재한다.

###

### 1. DB 주도 설계를 유도한다

- 3계층 구조에서 도메인 계층은 영속성 계층에 의존한다.
  - 자연스럽게 도메인 계층은 DB에 의존하게 된다.
  - 또한 도메인 계층이 영속 계층과 강하게 결합된다.
    - 트랜잭션, 로딩, 캐시 플러시 등등
- `도메인 로직` vs `DB`
  - 무엇을 중심으로 아키텍처를 설계해야 할까?
  - 3계층 구조에서는 의존성 방향에 따라 DB부터 설계하는 것이 맞음
  - 하지만 애플리케이션의 핵심은 `도메인 로직`이다.

###

- 내 생각 (유연성 vs 구현의 편리함)
  - 도메인 모델을 엔티티로 둘 때 편리한 점도 분명 존재함.
  - 단, 영속성 기술을 변경하면 도메인 로직에도 변경이 필요해진다.



### 2. 지름길을 택하기 쉬워진다  (이해가 아직 안 됨)

- 3계층 구조의 규칙
  - 특정 계층은 같은 계층 or 하위 계층에만 접근이 가능하다.
  - 이 규칙은 컴포넌트들을 점점하위로 내리게 된다.
    - 아래 계층에서 접근할 수 있게 하기 위해
  - 결국 영속성 계층에 수많은 `헬퍼`, `유틸` 클래스가 생기고 비대해진다.



### 3. 테스트하기 어려워진다

- 전제: 웹 계층에서 영속성 계층에 바로 접근하게 됨

  1. 유스케이스가 확장되면 웹 계층에 핵심 로직이 들어가게 될 수 있다.

  2. 웹 계층 테스트에 도메인 / 영속성 계층 모킹이 필요해짐



### 4. 유스케이스를 숨긴다

- 기능 추가 / 기능 변경을 위한 적절한 위치를 찾는 것
  - 좋은 아키텍처는 적절한 위치를 찾기 쉬워야 한다.
- 3계층 구조는 도메인 로직이 여러 계층에 흩어지기 쉽다
  - 웹 계층 -> 영속성 계층: 웹 계층에 도메인 로직이 포함되는 경우
  - 컴포넌트를 아래 계층으로 내리는 경우
- 3계층 구조는 넓은 범위를 담당하는 서비스가 만들어지기도 한다. (너비에 관한 규칙이 강제되지 않아서)
  - 넓은 범위의 서비스는 많은 영속성 컴포넌트에 의존하고, 웹 레이어의 많은 컴포넌트가 해당 서비스를 의존함

###

- 내 생각
  - 범위가 넓은 서비스가 만들어지는 건 아키텍처의 문제는 아닌듯 싶다.
  - 3계층 내에서도 얼마든지 서비스 범위를 제한할 수 있지 않을까



### 5. 동시 작업이 어려워진다

- 영속 / 도메인 / 웹은 순차적으로 개발이 진행된다. (동시 작업 불가)
  - 기능 1개당 1명 할당이 적합
- 넓은 서비스가 있더면 더더욱 동시 작업은 어려워진다.



###



### 정리

- 계층형 아키텍처의 단점이라기보다는 계층형 아키텍처가 야기할 수 있는 단점에 가깝다.
- 개발 규칙이 있고 지킨다면 겪지 않을 단점들도 있다는 생각이 든다.
- 다만 저자는 `계층형 아키텍처에는 정해진 규칙이 없다는 점`, `여러 개발자가 개발하고 시간이 흐르면 깨지기 쉽다는 점`을 말하려는 것 같다.
- 그렇다면 헥사고날 아키텍처는 아키텍처 자체에 보다 많은 규칙이 포함되어 있는 건가?
